def encode(text)
  output = text.chars.map do |c| 
    binary = sprintf("%08d", c.ord.to_s(2))
    binary.chars.map { |dig| dig * 3 }.join
  end

  output.join
end

def decode(bits)
  fixed = bits.chars.each_slice(3).map do |trip_bit|
    trip_bit.count('0') > trip_bit.count('1') ? '0' : '1'
  end

  fixed.each_slice(8).map { |byte| byte.join.to_i(2).chr }.join
end

p encode("hey") == "000111111000111000000000000111111000000111000111000111111111111000000111"
p encode("The Sensei told me that i can do this kata") == "000111000111000111000000000111111000111000000000000111111000000111000111000000111000000000000000000111000111000000111111000111111000000111000111000111111000111111111000000111111111000000111111000111111000000111000111000111111000111000000111000000111000000000000000000111111111000111000000000111111000111111111111000111111000111111000000000111111000000111000000000000111000000000000000000111111000111111000111000111111000000111000111000000111000000000000000000111111111000111000000000111111000111000000000000111111000000000000111000111111111000111000000000000111000000000000000000111111000111000000111000000111000000000000000000111111000000000111111000111111000000000000111000111111000111111111000000000111000000000000000000111111000000111000000000111111000111111111111000000111000000000000000000111111111000111000000000111111000111000000000000111111000111000000111000111111111000000111111000000111000000000000000000111111000111000111111000111111000000000000111000111111111000111000000000111111000000000000111"
p encode("T3st") == "000111000111000111000000000000111111000000111111000111111111000000111111000111111111000111000000"
p encode("T?st!%") == "000111000111000111000000000000111111111111111111000111111111000000111111000111111111000111000000000000111000000000000111000000111000000111000111"
p decode("100111111000111001000010000111111000000111001111000111110110111000010111") == "hey"
p decode("000111000111000111000100000111111000111000001000000111111000000111000111000100111000000000000000000111000111000000111111000111111000000111000111000111111000111111111000000111111111000000111111000110111000010111000111000111111000111001000111000000111000000000000000000111111111000111000000000111111000111111111111000111111000111111000000000111111000000111000001000000111000000000001000000111111000111111000111000111111000000111000111000000111000000000000000000111111111000111000000000111111000111000000000000111111000000010000111000111111111000111000000000100111000000000000000000111111000111000000111000000111000000000000000000111111000000000111111000111111000000000000111000111111000111111111000000000111000000000000010000111111000000111000000000111111000111111110111000000111000000000000000000111111111000111000000000111111000111000000000000111111000111000000111000111111111000000111111000000111000000000000000000111111000111000111111000111111000000000000111000111111111000111000000000111111000000000000111") == "The Sensei told me that i can do this kata"
p decode("000111000111000111000001000000111111000000111111000111111111000000111011000111111111000111000000") == "T3st"
p decode("000111000111000111000010000000111111111111011111000111111111000000111111000111101111000111000000000000111000000000000111000000111000000111000111") == "T?st!%"
